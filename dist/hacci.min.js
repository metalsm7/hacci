"use strict";var Hacci=function(){function Hacci(e){if(void 0===e&&(e=null),this._el=null,this._refs={},this._on={created:null,mounted:null,destroyed:null},this._event_listeners=[],(e=e||{el:null,template:null,data:null,method:null,created:null,mounted:null,destroyed:null}).el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),n=0;n<t.length;n++)this[t[n]]=e.data[t[n]];if(e.method)for(var i=Object.keys(e.method),n=0;n<i.length;n++)this[i[n]]=e.method[i[n]].bind(this);e.created&&(this._on.created=e.created.bind(this)),e.mounted&&(this._on.mounted=e.mounted.bind(this)),e.destroyed&&(this._on.destroyed=e.destroyed.bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Hacci.prototype.init=function(){var s=this;if(this.el){new MutationObserver(function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];"childList"!==r.type||(r=r.removedNodes)&&0<r.length&&r[0]===s.el&&(t.disconnect(),s.clearEventListeners(),s._on&&s._on.destroyed&&s._on.destroyed())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1});for(var r=this.el.querySelectorAll("*"),a=this,e=0;e<r.length;e++)!function(e){for(var i=r[e],t=i.attributes,n=0;n<t.length;n++)if(/^hc:/.test(t[n].name))switch(t[n].name){case"hc:ref":a._refs[t[n].value]=i;break;case"hc:click":a.registEventListener(i,"click",t[n]);break;case"hc:input":-1<["INPUT","SELECT"].indexOf(i.tagName)&&-1<["radio","checkbox","select-one","select-multiple"].indexOf(i.type)&&a.registEventListener(i,"change",t[n]),-1<["INPUT","TEXTAREA"].indexOf(i.tagName)&&-1<["text","textarea"].indexOf(i.type)&&a.registEventListener(i,"input",t[n]),-1<["INPUT","TEXTAREA","SELECT"].indexOf(i.tagName)&&-1<["text","textarea","select-one","select-multiple"].indexOf(i.type)&&a.observeElement(i,"value",function(e,t){var n=null;"function"==typeof Event?n=new Event("input"):(n=document.createEvent("Event")).initEvent("input",!0,!0),i.dispatchEvent(n)}),-1<["INPUT"].indexOf(i.tagName)&&-1<["radio","checkbox"].indexOf(i.type)&&a.observeElement(i,"checked",function(e,t){var n=null;"function"==typeof Event?n=new Event("change"):(n=document.createEvent("Event")).initEvent("change",!0,!0),i.dispatchEvent(n)});break;case"hc:value":i.value=a[t[n].value];break;case"hc:checked":case"hc:selected":(-1<["true","false"].indexOf(t[n].value)?"true"===t[n].value:a[t[n].value])?i.setAttribute(t[n].name.substring(3),null):i.removeAttribute(t[n].name.substring(3))}}(e)}this._on&&this._on.mounted&&this._on.mounted()},Hacci.prototype.refresh=function(){this.clearEventListeners(),this.init()},Hacci.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},Hacci.prototype.registEventListener=function(e,t,n){function i(e){r.callMethod({attr:n,evt:e})}var r=this;e.addEventListener(t,i),this._event_listeners.push({el:e,name:t,listener:i})},Hacci.prototype.callMethod=function(option){var has_bracket=-1<option.attr.value.indexOf("("),method_name=has_bracket?option.attr.value.replace(/\(.*/,""):option.attr.value,args_1;has_bracket?(args_1=option.attr.value.replace(/^\w*\(/,"").replace(/\)$/,"").split(","),args_1.forEach(function(el,idx){var new_el=el.replace(/^\s*/,"").replace(/\s*$/,"");args_1[idx]="_event"===new_el?option.evt:eval(new_el)}),args_1.length<2&&""===args_1[0]&&(args_1[0]=option.evt),this[method_name].apply(this,args_1)):this[method_name](option.evt)},Hacci.prototype.observeElement=function(e,n,i){var r,t=Object.getPrototypeOf(e);t.hasOwnProperty(n)&&(r=Object.getOwnPropertyDescriptor(t,n),Object.defineProperty(e,n,{get:function(){return r.get.apply(this,arguments)},set:function(){var e=this[n];r.set.apply(this,arguments);var t=this[n];return i&&setTimeout(i.bind(this,e,t),0),t}}))},Hacci.prototype.destroy=function(){this.clearEventListeners(),this._el=null,this._refs={},this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null}},Hacci.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(Hacci.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(Hacci.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),Hacci}();window.Hacci=Hacci;
