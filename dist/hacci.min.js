"use strict";var Hacci=function(){function Hacci(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._traces={model:{}},this._on={created:null,mounted:null,destroyed:null},this._event_listeners=[],this._type_of_event_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],(e=e||{id:null,el:null,template:null,data:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,Hacci.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),n=0;n<t.length;n++)this[t[n]]=e.data[t[n]];if(e.method)for(var r=Object.keys(e.method),n=0;n<r.length;n++)this[r[n]]=this.fromArrowFunc(e.method[r[n]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(Hacci,"instances",{get:function(){return Hacci._instances},enumerable:!0,configurable:!0}),Hacci.prototype.init=function(){var o=this,c=this;if(this.el){new MutationObserver(function(e,t){for(var n=0,r=e;n<r.length;n++){var a=r[n];"childList"!==a.type||(a=a.removedNodes)&&0<a.length&&a[0]===o.el&&(t.disconnect(),o.clearEventListeners(),o.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1});for(var n=this.el.querySelectorAll("*"),e=function(e){for(var i=n[e],l=i.attributes,t=0;t<l.length;t++)!function(a){var e,t,n;/^hc:model$/.test(l[a].name)&&(r.traceModel({parent:r,property:l[a].value,value:null}),"INPUT"===i.tagName&&-1<["radio","checkbox"].indexOf(i.type)?(n=r.getVal(l[a].value,r),(e=i.hasAttribute("name")?i.getAttribute("name"):null)&&(t=c.el.querySelectorAll("*[name="+e+"]"),c.setCheckedValue(t,n.val)),i.addEventListener("change",function(e){var t=null;"radio"===i.type&&(t=i.checked?i.value:null),"checkbox"===i.type&&(t=i.checked?i.value:[]);var n=i.hasAttribute("name")?i.getAttribute("name"):null;n&&(r=c.el.querySelectorAll("*[name="+n+"]"),t=c.getCheckedValue(r,"checkbox"===i.type));var r=c.getVal(l[a].value,c._traces.model,"__");r.parent[r.prop]=t,o.modelTrigger(i)})):"SELECT"===i.tagName&&-1<["select-one","select-multiple"].indexOf(i.type)?(n=r.getVal(l[a].value,r),t=i.querySelectorAll("option"),c.setSelectedValue(t,n.val),i.addEventListener("change",function(e){i.type;var t=i.querySelectorAll("option"),n=c.getSelectedValue(t,"select-multiple"===i.type),t=c.getVal(l[a].value,c._traces.model,"__");t.parent[t.prop]=n,o.modelTrigger(i)})):-1<["INPUT","TEXTAREA"].indexOf(i.tagName)&&-1<c._type_of_event_input.indexOf(i.type)&&(n=r.getVal(l[a].value,r),i.value=n.val,i.addEventListener("input",function(e){var t=i.value,n=c.getVal(l[a].value,c._traces.model,"__");n.parent[n.prop]=t,o.modelTrigger(i)})))}(t)},r=this,t=0;t<n.length;t++)e(t);for(t=0;t<n.length;t++)for(var a=n[t],i=a.attributes,l=0;l<i.length;l++)if(/^hc:/.test(i[l].name))switch(i[l].name){case"hc:ref":this._refs[i[l].value]=a;break;case"hc:click":this.registEventListener(a,"click",i[l]);break;case"hc:change":-1<["INPUT","SELECT"].indexOf(a.tagName)&&-1<["radio","checkbox","select-one","select-multiple"].indexOf(a.type)&&this.registEventListener(a,"change",i[l]);break;case"hc:input":-1<["INPUT","TEXTAREA"].indexOf(a.tagName)&&-1<c._type_of_event_input.indexOf(a.type)&&this.registEventListener(a,"input",i[l]);break;case"hc:text":a.innerText=this[i[l].value];break;case"hc:html":a.innerHTML=this[i[l].value]}}this._on&&this._on.mounted&&this._on.mounted()},Hacci.prototype.refresh=function(){this.clearData(),this.clearEventListeners(),this.init()},Hacci.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),n=0;n<t.length;n++)e.test(t[n])&&delete this[t[n]]},Hacci.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},Hacci.prototype.modelTrigger=function(e){for(var t=null,n=e.attributes,r=0;r<n.length;r++)if(/^hc:model$/.test(n[r].name)){t=n[r];break}if(t)for(var a=this.getVal(t.value,this),i=this.el.querySelectorAll("*"),r=0;r<i.length;r++)for(var l=i[r],n=l.attributes,o=0;o<n.length;o++)if(/^hc:model$/.test(n[o].name)&&n[o].value===t.value)if("INPUT"===l.tagName&&-1<["radio","checkbox"].indexOf(l.type))Array.isArray(a.val)?l.checked=-1<a.val.indexOf(l.value):l.checked=a.val==l.value;else if("SELECT"===l.tagName&&-1<["select-one","select-multiple"].indexOf(l.type))for(var c=l.querySelectorAll("option"),s=0;s<c.length;s++)Array.isArray(a.val)?c[s].selected=-1<a.val.indexOf(c[s].value):c[s].selected=a.val==c[s].value;else-1<["INPUT","TEXTAREA"].indexOf(l.tagName)&&-1<this._type_of_event_input.indexOf(l.type)&&(l.value=a.val)},Hacci.prototype.registEventListener=function(e,t,n){function r(e){a.callMethod({attr:n,evt:e})}var a=this;e.addEventListener(t,r),this._event_listeners.push({el:e,name:t,listener:r})},Hacci.prototype.callMethod=function(option){var has_bracket=-1<option.attr.value.indexOf("("),method_name=has_bracket?option.attr.value.replace(/\(.*/,""):option.attr.value,args_1;has_bracket?(args_1=option.attr.value.replace(/^\w*\(/,"").replace(/\)$/,"").split(","),args_1.forEach(function(el,idx){var new_el=el.replace(/^\s*/,"").replace(/\s*$/,"");args_1[idx]="_event"===new_el?option.evt:eval(new_el)}),args_1.length<2&&""===args_1[0]&&(args_1[0]=option.evt),this[method_name].apply(this,args_1)):this[method_name](option.evt)},Hacci.prototype.commitEvent=function(e,t){var n=null;"function"==typeof Event?n=new Event(t):(n=document.createEvent("Event")).initEvent(t,!0,!0),e.dispatchEvent(n)},Hacci.prototype.createInstanceId=function(){for(var e="",t=0;t<8;t++){var n=Math.floor(51*Math.random());e+=String.fromCharCode(n+(n<26?65:71))}return e+="_"+Date.now()},Hacci.prototype.isArrowFunc=function(e){return void 0===e.prototype},Hacci.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},Hacci.prototype.getCheckedValue=function(e,t){for(var n=(t=void 0===t?!1:t)?[]:null,r=0;r<e.length;r++){var a=e[r];if(a.checked&&!t){n=a.value;break}a.checked&&t&&n.push(a.value)}return n},Hacci.prototype.getSelectedValue=function(e,t){for(var n=(t=void 0===t?!1:t)?[]:null,r=0;r<e.length;r++){var a=e[r];if(a.selected&&!t){n=a.value;break}a.selected&&t&&n.push(a.value)}return n},Hacci.prototype.setCheckedValue=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(t)?r.checked=-1<t.indexOf(r.value):r.checked=t===r.value}},Hacci.prototype.setSelectedValue=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(t)?r.selected=-1<t.indexOf(r.value):r.selected=t===r.value}},Hacci.prototype.getVal=function(val,init_parent,prefix){if(void 0===prefix&&(prefix=""),new RegExp(/^(true|false|'.+'|\d+)$/).test(val))return{parent:null,prop:null,val:eval(val)};for(var rtn_val={parent:null,prop:null,val:init_parent},strs=val.split("."),cnti=0;cnti<strs.length;cnti++)0!==cnti?(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[cnti],rtn_val.val=rtn_val.val[prefix+strs[cnti]]):(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[0],rtn_val.val=rtn_val.val[prefix+strs[0]]);return rtn_val},Hacci.prototype.setVal=function(e,t,n){for(var r=n,a=e.split("."),i=0;i<a.length;i++)void 0===r["__"+a[i]]&&(r["__"+a[i]]={}),i>=a.length-1?r["__"+a[i]]=t:r=r["__"+a[i]]},Hacci.prototype.traceModel=function(t){var p,n,r,a;new RegExp(/^(true|false|'.+'|\d+)$/).test(t.property)||(p=this,-1<["undefined","null"].indexOf(typeof t.parent)&&(t.parent=this),this._traces.model.__listen||(this._traces.model.__listen=function(e,t){for(var n=[],r={change:[],input:[]},a=p.el.querySelectorAll("*"),i=0;i<a.length;i++)for(var l,o,c,s=a[i],u=s.attributes,h=0;h<u.length;h++)/^hc:model$/.test(u[h].name)&&u[h].value===e&&("INPUT"===s.tagName&&-1<["radio","checkbox"].indexOf(s.type)?(l=s.hasAttribute("name")?s.getAttribute("name"):null,o=-1<n.indexOf(l),l&&(c=p.el.querySelectorAll("*[name="+l+"]"),p.setCheckedValue(c,t)),o||(n.push(l),r.change.indexOf(s)<0&&r.change.push(s))):"SELECT"===s.tagName&&-1<["select-one","select-multiple"].indexOf(s.type)?(c=s.querySelectorAll("option"),p.setSelectedValue(c,t),r.change.indexOf(s)<0&&r.change.push(s)):-1<["INPUT","TEXTAREA"].indexOf(s.tagName)&&-1<p._type_of_event_input.indexOf(s.type)&&(s.value=t,r.input.indexOf(s)<0&&r.input.push(s)));for(i=0;i<r.change.length;i++)p.commitEvent(r.change[i],"change");for(i=0;i<r.input.length;i++)p.commitEvent(r.input[i],"input")}),n=this._traces.model,r=this.getVal(t.property,this),this.setVal(t.property,r.val,n),a=this.getVal(t.property,n,"__"),r.parent&&r.prop&&Object.defineProperty(r.parent,r.prop,{get:function(){return p.getVal(t.property,n,"__").val},set:function(e){a.parent["__"+r.prop]=e,n.__listen(t.property,e)}}))},Hacci.prototype.destroy=function(){this.clearEventListeners(),this._refs={},this._template&&this.el.parentElement.removeChild(this.el),this._template=null,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null},Hacci.instances[this._id]&&(Hacci.instances[this._id]=null,delete Hacci.instances[this._id])},Hacci.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(Hacci.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(Hacci.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),Hacci._instances={},Hacci}();window.Hacci=Hacci;
