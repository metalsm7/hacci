"use strict";var Hacci=function(){function o(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._traces={model:{value:{},listen:null},elements:[],txts:[]},this._txts_mstr=null,this._event_listeners=[],this._on={created:null,mounted:null,destroyed:null},this._toi_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],this._toi_check=["radio","checkbox"],this._toi_select=["select-one","select-multiple"],this._bus={},(e=e||{id:null,el:null,template:null,data:null,computed:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,o.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),r=0;r<t.length;r++)this[t[r]]=e.data[t[r]],this.redefineModel(t[r]);if(e.computed)for(var n=Object.keys(e.computed),r=0;r<n.length;r++)this[n[r]]=this.fromArrowFunc(e.computed[n[r]]).bind(this);if(e.method)for(var i=Object.keys(e.method),r=0;r<i.length;r++)this[i[r]]=this.fromArrowFunc(e.method[i[r]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(o,"instances",{get:function(){return o._instances},enumerable:!0,configurable:!0}),o.prototype.init=function(){var o=this,l=this;if(!l._txts_mstr){l._txts_mstr="";for(var e=Object.keys(l),t=0;t<e.length;t++)1<e[t].length&&"_"===e[t].charAt(0)||(l._txts_mstr+="var "+e[t]+"=this."+e[t]+";\n")}function s(e,t){return new Function("this."+e+"=arguments[0];(Array.isArray(this."+e+") && this.arrayEventListener(this."+e+"));").apply(l,[t])}new MutationObserver(function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];"childList"!==i.type||(i=i.removedNodes)&&0<i.length&&i[0]===o.el&&(t.disconnect(),o.clearEventListeners(),o.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1}),this.searchTextNodes();for(var n=this.el.querySelectorAll("*"),r=function(e){for(var i,o=n.item(e),a=o.attributes,t=function(e){var n=a.item(e);if(/^hc:.+$/.test(n.name)){var t,r=n.name.substring(3);if("ref"==r)return(l._refs[n.value]=o).hasAttribute(n.name)&&(o.removeAttribute(n.name),--e),i=e,"continue";switch(l._traces.elements.indexOf(o)<0&&l._traces.elements.push(o),o._hc||(o._hc={attr:{},comment:null}),"neither"===r?o._hc.attr.if="!("+n.value+")":o._hc.attr[r]=n.value,"model"===r&&(t=function(e){e=new Function(l._txts_mstr+"return "+e+";").apply(l);return e="function"==typeof e?e():e}(n.value),Array.isArray(t)&&l.arrayEventListener(t),"INPUT"===o.tagName&&-1<["radio","checkbox"].indexOf(o.type)&&o.addEventListener("change",function(e){var t=null;"radio"===o.type&&(t=o.checked?o.value:null),"checkbox"===o.type&&(t=o.checked?o.value:o.hasAttribute("name")?[]:null);var r=o.hasAttribute("name")?o.getAttribute("name"):null;t=r?(r=l.el.querySelectorAll("*[name="+r+"]"),l.getCheckedValue(r,"checkbox"===o.type)):o.checked?o.value:null,o["_hc:force_apply"]=!0,s(n.value,t)}),"SELECT"===o.tagName&&-1<["select-one","select-multiple"].indexOf(o.type)&&o.addEventListener("change",function(e){o.type;var t=o.querySelectorAll("option"),r=l.getSelectedValue(t,"select-multiple"===o.type);o["_hc:force_apply"]=!0,s(n.value,r)}),-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<["email","hidden","number","password","search","tel","url","datetime","text","textarea"].indexOf(o.type)&&o.addEventListener("input",function(e){o["_hc:force_apply"]=!0,s(n.value,o.value)})),r){case"click":case"scroll":l.registEventListener(o,r,n);break;case"scroll.hit.top":case"scroll.hit.bottom":l.registEventListener(o,"scroll",n,function(e){(-1<n.name.indexOf("bottom")?l.scrollTop(o)+l.innerHeight(o)>=l.scrollHeight(o):l.scrollTop(o)<=0)&&function(e){var t=e;e.indexOf("(")<0&&(t+="()");t=t.replace(/;$/,"");new Function(l._txts_mstr+"return "+t+";").apply(l)}(n.value)})}o.hasAttribute(n.name)&&(o.removeAttribute(n.name),--e)}i=e},r=0;r<a.length;r++)t(r),r=i},t=0;t<n.length;t++)r(t);this.applyModel(),this._on&&this._on.mounted&&this._on.mounted()},o.prototype.redefineModel=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=this;n._traces.model.listen||(n._traces.model.listen=function(){n.applyModel()}),t=t||n;var i=n._traces.model.value,o=r?r+".__"+e:"__"+e;void 0===i[o]&&(i[o]=t[e]);var a=t[e];if(Object.defineProperty(t,e,{get:function(){return i[o]},set:function(e){i[o]=e,Array.isArray(i[o])&&n.arrayEventListener(i[o]),n._traces.model.listen(o,i[o]),n.applyTextChange()}}),a instanceof Object&&-1<["object"].indexOf(typeof a))for(var l=Object.keys(a),s=0;s<l.length;s++){var c=l[s];this.redefineModel(c,a,o)}},o.prototype.applyModel=function(){for(var r=this,e=function(e){e=new Function(r._txts_mstr+"return "+e+";").apply(r);return e="function"==typeof e?e():e},t=function(e){var t=e;e.indexOf("(")<0&&(t+="()");t=t.replace(/;$/,"");return new Function(r._txts_mstr+"return "+t+";").apply(r)},n=[],i=0;i<r._traces.elements.length;i++){var o,a,l,s,c,u,h=r._traces.elements[i],d=h._hc;d.attr.if&&(!0===(o=e(d.attr.if))&&d.comment?(d.comment.parentNode.insertBefore(h,d.comment),d.comment.parentNode.removeChild(d.comment),delete d.comment,d.comment=null):!1!==o||d.comment||(d.comment=window.document.createComment("//hc:"+r._id+":"+r.createTagId()),h.parentNode.insertBefore(d.comment,h),h.parentNode.removeChild(h))),d.attr.disabled&&(o=e(d.attr.disabled),h.disabled=o),d.attr.html&&(o=e(d.attr.html),h.innerHTML=o),d.attr.text&&(o=e(d.attr.text),h.innerText=o),d.attr.value&&(o=e(d.attr.value),h.value=o),d.attr.model&&(o=e(d.attr.model),"INPUT"===h.tagName&&-1<r._toi_check.indexOf(h.type)?(l=!1,(a=h.hasAttribute("name")?h.getAttribute("name"):null)?n.indexOf(a)<0&&(n.push(a),s=r.el.querySelectorAll("*[name="+a+"]"),u=r.setCheckedValue(s,o),l=d.attr.change&&u):(c=h.checked,h.checked=h.value==o,l=h.checked!=c),!l&&h["_hc:force_apply"]&&(l=!0,delete h["_hc:force_apply"]),l&&d.attr.change&&t(d.attr.change)):"SELECT"===h.tagName&&-1<r._toi_select.indexOf(h.type)?(l=!1,s=h.querySelectorAll("option"),u=r.setSelectedValue(s,o),!(l=d.attr.change&&u)&&h["_hc:force_apply"]&&(l=!0,delete h["_hc:force_apply"]),l&&d.attr.change&&t(d.attr.change)):-1<["INPUT","TEXTAREA"].indexOf(h.tagName)&&-1<r._toi_input.indexOf(h.type)&&(c=!1,u=h.value!=o,h.value=o,!(c=d.attr.input&&u)&&h["_hc:force_apply"]&&(c=!0,delete h["_hc:force_apply"]),c&&d.attr.input&&t(d.attr.input)))}},o.prototype.arrayEventListener=function(n){var i=this;n.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.push).call.apply(r,[n].concat(e));return i._traces.model.listen(),r},n.pop=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.pop).call.apply(r,[n].concat(e));return i._traces.model.listen(),r},n.splice=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.splice).call.apply(r,[n].concat(e));return i._traces.model.listen(),r},n.shift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.shift).call.apply(r,[n].concat(e));return i._traces.model.listen(),r},n.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.unshift).call.apply(r,[n].concat(e));return i._traces.model.listen(),r}},o.prototype.registEventListener=function(e,t,r,n){var i=this;e.addEventListener(t,n=(n=void 0===n?null:n)||function(e){!function(e,t){var r=t;t.indexOf("(")<0&&(r+="(_event)");r=r.replace(/;$/,"");new Function(i._txts_mstr+"try{ var _event=arguments[0]; } catch(e) { _event=arguments[0]; }\nreturn "+r+";").apply(i,[e])}(e,r.value)}),this._event_listeners.push({el:e,name:t,listener:n})},o.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},o.prototype.searchTextNodes=function(e){if((e=(e=void 0===e?null:e)||this.el).hasChildNodes()){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeType){case 1:this.searchTextNodes(e.childNodes[t]);break;case 3:/{{([^}}\r\n]+)?}}/g.test(e.childNodes[t].textContent)&&this._traces.txts.push({node:e.childNodes[t],text:e.childNodes[t].textContent,fn:null})}this.applyTextChange()}},o.prototype.applyTextChange=function(){for(var e=this._traces.txts,t=0;t<e.length;t++)e[t].fn||(e[t].fn=this.compileText(e[t].text)),e[t].node.textContent=e[t].fn.apply(this)},o.prototype.compileText=function(e){if(!this._txts_mstr){this._txts_mstr="";for(var t=Object.keys(this),r=0;r<t.length;r++)1<t[r].length&&"_"===t[r].charAt(0)||(this._txts_mstr+="var "+t[r]+"=this."+t[r]+";\n")}for(var n,i=/{{([^}}]+)?}}/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,a=this._txts_mstr+"var r=[];\n",l=0,s=function(e,t){return a+=(t=void 0===t?null:t)?e.match(o)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};n=i.exec(e);)s(e.slice(l,n.index))(n[1],!0),l=n.index+n[0].length;return s(e.substr(l,e.length-l)),a+='return r.join("");',new Function(a.replace(/[\r\t\n]/g,""))},o.prototype.scrollHeight=function(e){return 9===e.nodeType?Number(window.document.documentElement.scrollHeight):Number(e.scrollHeight)},o.prototype.scrollTop=function(e){e=9===e.nodeType?window.pageYOffset:e.scrollTop;return Math.ceil(e)},o.prototype.innerHeight=function(e){e=9===e.nodeType?Number(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.documentElement.clientHeight)):Number(e.clientHeight);return Math.ceil(e)},o.prototype.refresh=function(){this.clearData(),this.init()},o.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),r=0;r<t.length;r++)e.test(t[r])&&delete this[t[r]]},o.prototype.getRandomString=function(e){for(var t="",r=0;r<e;r++){var n=Math.floor(51*Math.random());t+=String.fromCharCode(n+(n<26?65:71))}return t},o.prototype.createInstanceId=function(){return this.getRandomString(8)+"_"+Date.now()},o.prototype.createTagId=function(){return this.getRandomString(6)+"_"+Date.now()},o.prototype.isArrowFunc=function(e){return void 0===e.prototype},o.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},o.prototype.getCheckedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var i=e[n];if(i.checked&&!t){r=i.value;break}i.checked&&t&&r.push(i.value)}return r},o.prototype.getSelectedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var i=e[n];if(i.selected&&!t){r=i.value;break}i.selected&&t&&r.push(i.value)}return r},o.prototype.setCheckedValue=function(e,t){for(var r=!1,n=!1,i=0;i<e.length;i++){var o=e[i];if(!n&&o.checked&&(n=!0),r=!r&&(o.checked&&(Array.isArray(t)?t.indexOf(o.value)<0:t!=o.value)||!o.checked&&(Array.isArray(t)?-1<t.indexOf(o.value):t==o.value))?!0:r)break}for(i=0;i<e.length;i++)(o=e[i]).checked=Array.isArray(t)?-1<t.indexOf(o.value):t==o.value;return r},o.prototype.setSelectedValue=function(e,t){for(var r=!1,n=!1,i=0;i<e.length;i++){var o=e[i];if(!n&&o.selected&&(n=!0),r=!r&&(o.selected&&(Array.isArray(t)?t.indexOf(o.value)<0:t!=o.value)||!o.selected&&(Array.isArray(t)?-1<t.indexOf(o.value):t==o.value))?!0:r)break}for(i=0;i<e.length;i++)(o=e[i]).selected=Array.isArray(t)?-1<t.indexOf(o.value):t==o.value;return r},o.prototype.on=function(e,t){this._bus[e]||(this._bus[e]=[]),-1<this._bus[e].indexOf(t)||this._bus[e].push(t)},o.prototype.off=function(e,t){void 0===t&&(t=null),this._bus[e]&&!t?delete this._bus[e]:this._bus[e]&&t&&(-1<(t=this._bus[e].indexOf(t))&&this._bus[e].splice(t,1))},o.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!this._bus[e])return 0;for(var i=0,o=0;o<this._bus[e].length;o++)try{(t=this._bus[e])[o].apply(t,r),i++}catch(e){}return i},o.prototype.destroy=function(){},o.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(o.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),o._instances={},o}();window.Hacci=Hacci;
