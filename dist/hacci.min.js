"use strict";var Hacci=function(){function i(e){void 0===e&&(e=null);var l=this;if(this._id=null,this._el=null,this._refs={},this._traces={model:{value:{},listen:null},elements:[],txts:[],fors:[]},this._txts_mstr=null,this._event_listeners=[],this._on={created:null,mounted:null,destroyed:null},this._toi_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],this._toi_check=["radio","checkbox"],this._toi_select=["select-one","select-multiple"],this._bus={},(e=e||{id:null,el:null,template:null,data:null,computed:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,i.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),r=0;r<t.length;r++)this[t[r]]=e.data[t[r]],this.redefineModel(t[r]);if(e.computed)for(var n=Object.keys(e.computed),r=0;r<n.length;r++)this[n[r]]=this.fromArrowFunc(e.computed[n[r]]).bind(this);if(e.method)for(var o=Object.keys(e.method),r=0;r<o.length;r++)this[o[r]]=this.fromArrowFunc(e.method[o[r]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),new MutationObserver(function(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];"childList"!==o.type||(o=o.removedNodes)&&0<o.length&&o[0]===l.el&&(t.disconnect(),l.clearEventListeners(),l.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1}),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(i,"instances",{get:function(){return i._instances},enumerable:!0,configurable:!0}),i.prototype.init=function(){var e=this;if(!e._txts_mstr){e._txts_mstr="";for(var t=Object.keys(e),r=0;r<t.length;r++)1<t[r].length&&"_"===t[r].charAt(0)||(e._txts_mstr+="var "+t[r]+"=this."+t[r]+";\n")}this.searchNodes(e.el),this.searchTextNodes(e.el),this.applyModel(),this._on&&this._on.mounted&&this._on.mounted()},i.prototype.procForNodes=function(e){for(var t=this,r=e.querySelectorAll("*"),n=0;n<r.length;n++)for(var o=r.item(n),l=o.attributes,i=0;i<l.length;i++){var s,c=l.item(i);/^hc:for$/.test(c.name)&&(t._traces.fors.indexOf(o)<0&&t._traces.fors.push(o),s=window.document.createComment("//hc-for:"+t._id+":"+t.createTagId()),o.parentNode.insertBefore(s,o),o.parentNode.removeChild(o),o._hc||(o._hc={attr:{},comment:null,for_comment:null,for_elements:[],for_txts:[],model_str:null}),o._hc.attr.for=c.value,o._hc.for_comment=s)}t.applyFor()},i.prototype.searchNodes=function(e){this.procForNodes(e),this.procNode(e.querySelectorAll("*"),e)},i.prototype.procNode=function(o,l){void 0===l&&(l=null);function i(e,t){return new Function("this."+e+"=arguments[0];(Array.isArray(this."+e+") && this.arrayEventListener(this."+e+"));").apply(s,[t])}var s=this;if(o instanceof NodeList)for(var e=0;e<o.length;e++)s.procNode(o.item(e),l);else for(var c,a=o.attributes,t=function(e){var n=a.item(e);if(!/^hc:.+$/.test(n.name))return c=e,"continue";var t,r=n.name.substring(3);if("for"===r)return o.hasAttribute(n.name)&&(o.removeAttribute(n.name),--e),c=e,"continue";if("ref"===r)return(s._refs[n.value]=o).hasAttribute(n.name)&&(o.removeAttribute(n.name),--e),c=e,"continue";switch((!l||l&&!l._hc)&&s._traces.elements.indexOf(o)<0&&s._traces.elements.push(o),o._hc||(o._hc={attr:{},comment:null,for:null}),"neither"===r?o._hc.attr.if="!("+n.value+")":o._hc.attr[r]=n.value,"model"===r&&(t=function(e,t){void 0===t&&(t=null);e=new Function(""+s._txts_mstr+(t||"")+"return "+e+";").apply(s);return e="function"==typeof e?e():e}(n.value,l&&l._hc&&l._hc.model_str?l._hc.model_str:null),Array.isArray(t)&&s.arrayEventListener(t),"INPUT"===o.tagName&&-1<["radio","checkbox"].indexOf(o.type)&&o.addEventListener("change",function(e){var t=null;"radio"===o.type&&(t=o.checked?o.value:null),"checkbox"===o.type&&(t=o.checked?o.value:o.hasAttribute("name")?[]:null);var r=o.hasAttribute("name")?o.getAttribute("name"):null;t=r?(r=l.querySelectorAll("*[name="+r+"]"),s.getCheckedValue(r,"checkbox"===o.type)):o.checked?o.value:null,o["_hc:force_apply"]=!0,i(n.value,t)}),"SELECT"===o.tagName&&-1<["select-one","select-multiple"].indexOf(o.type)&&o.addEventListener("change",function(e){o.type;var t=o.querySelectorAll("option"),r=s.getSelectedValue(t,"select-multiple"===o.type);o["_hc:force_apply"]=!0,i(n.value,r)}),-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<["email","hidden","number","password","search","tel","url","datetime","text","textarea"].indexOf(o.type)&&o.addEventListener("input",function(e){o["_hc:force_apply"]=!0,i(n.value,o.value)})),r){case"scroll.hit.top":case"scroll.hit.bottom":s.registEventListener(o,"scroll",n,function(e){(-1<n.name.indexOf("bottom")?s.scrollTop(o)+s.innerHeight(o)>=s.scrollHeight(o):s.scrollTop(o)<=0)&&function(e){var t=e;e.indexOf("(")<0&&(t+="()");t=t.replace(/;$/,"");new Function(s._txts_mstr+"return "+t+";").apply(s)}(n.value)});break;case"input":case"change":break;default:void 0!==window["on"+r]&&s.registEventListener(o,r,n)}o.hasAttribute(n.name)&&(o.removeAttribute(n.name),--e),c=e},e=0;e<a.length;e++)t(e),e=c},i.prototype.redefineModel=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=this;n._traces.model.listen||(n._traces.model.listen=function(){n.applyModel()}),t=t||n;var o=n._traces.model.value,l=r?r+".__"+e:"__"+e;void 0===o[l]&&(o[l]=t[e]);var i=t[e];if(Object.defineProperty(t,e,{get:function(){return o[l]},set:function(e){o[l]=e,Array.isArray(o[l])&&n.arrayEventListener(o[l]),n._traces.model.listen(l,o[l]),n.applyTextChange()}}),i instanceof Object&&-1<["object"].indexOf(typeof i))for(var s=Object.keys(i),c=0;c<s.length;c++){var a=s[c];this.redefineModel(a,i,l)}},i.prototype.applyFor=function(){for(var t=this,e=0;e<t._traces.fors.length;e++){var r=t._traces.fors[e],n=r._hc,o=(r.outerHTML,String(n.attr.for).replace(/(\(.*\)|.+)\s+(in)\s+/g,"").replace(/\s/g,"")),l=String(n.attr.for).replace(/\s+in\s+.*$/,"").replace(/\s/g,""),i=function(e){e=new Function(t._txts_mstr+"return "+e+";").apply(t);return e="function"==typeof e?e():e}(o),s=r._hc.for_comment.parentNode;delete r._hc.for_txts,r._hc.for_txts=[];for(var c=void 0;c<r._hc.for_elements.length;c++){var a=t._traces.for_elements.indexOf(r._hc.for_elements[c]);-1<a&&t._traces.for_elements.splice(a,1),s.removeChild(r._hc.for_elements[c]),c--}if("("===l.charAt(0))for(var h=l.substring(1,l.length-2).split(","),c=0;c<i.length;c++){for(var d="",u=0;u<h.length;u++)d+="var "+h[u]+"="+o+"["+c+"]['"+h[u]+"'];\n";r._hc.model_str=d;var p=r.cloneNode(!0);s.appendChild(p),t.procNode(p,r),t.procNode(p.querySelectorAll("*"),r),t.procTextNode(p,r),t.procTextModel(r),t.procModel(p,r),t.procModel(p.querySelectorAll("*"),r)}else for(c=0;c<i.length;c++){r._hc.model_str=d="var "+l+"="+o+"["+c+"];\n";p=r.cloneNode(!0);s.appendChild(p),t.procNode(p,r),t.procNode(p.querySelectorAll("*"),r),t.procTextNode(p,r),t.procTextModel(r),t.procModel(p,r),t.procModel(p.querySelectorAll("*"),r)}}},i.prototype.applyModel=function(){this.procModel(this._traces.elements,null)},i.prototype.procModel=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);function n(e){var t=e;return e.indexOf("(")<0&&(t+="()"),t=t.replace(/;$/,""),new Function(a._txts_mstr+"return "+t+";").apply(a)}var o,l,i,s,c,a=this,h=function(e,t){void 0===t&&(t=null);e=new Function(""+a._txts_mstr+(t||"")+"return "+e+";").apply(a);return e="function"==typeof e?e():e};if(e instanceof NodeList||Array.isArray(e)){r=r||[];for(var d=0;d<e.length;d++)a.procModel(e[d],t,r)}else e._hc&&((o=e._hc).attr.if&&(!0===(l=h(o.attr.if,t&&t._hc&&t._hc.model_str?t._hc.model_str:null))&&o.comment?(o.comment.parentNode.insertBefore(e,o.comment),o.comment.parentNode.removeChild(o.comment),delete o.comment,o.comment=null):!1!==l||o.comment||(o.comment=window.document.createComment("//hc:"+a._id+":"+a.createTagId()),e.parentNode.insertBefore(o.comment,e),e.parentNode.removeChild(e))),o.attr.disabled&&(l=h(o.attr.disabled,t&&t._hc&&t._hc.model_str?t._hc.model_str:null),e.disabled=l),o.attr.html&&(l=h(o.attr.html,t&&t._hc&&t._hc.model_str?t._hc.model_str:null),e.innerHTML=l),o.attr.text&&(l=h(o.attr.text,t&&t._hc&&t._hc.model_str?t._hc.model_str:null),e.innerText=l),o.attr.value&&(l=h(o.attr.value,t&&t._hc&&t._hc.model_str?t._hc.model_str:null),e.value=l),o.attr.model&&(l=h(o.attr.model,t&&t._hc&&t._hc.model_str?t._hc.model_str:null),"INPUT"===e.tagName&&-1<a._toi_check.indexOf(e.type)?(s=!1,(h=e.hasAttribute("name")?e.getAttribute("name"):null)?r.indexOf(h)<0&&(r.push(h),i=a.el.querySelectorAll("*[name="+h+"]"),c=a.setCheckedValue(i,l),s=o.attr.change&&c):(h=e.checked,e.checked=e.value==l,s=e.checked!=h),!s&&e["_hc:force_apply"]&&(s=!0,delete e["_hc:force_apply"]),s&&o.attr.change&&n(o.attr.change)):"SELECT"===e.tagName&&-1<a._toi_select.indexOf(e.type)?(s=!1,i=e.querySelectorAll("option"),c=a.setSelectedValue(i,l),!(s=o.attr.change&&c)&&e["_hc:force_apply"]&&(s=!0,delete e["_hc:force_apply"]),s&&o.attr.change&&n(o.attr.change)):-1<["INPUT","TEXTAREA"].indexOf(e.tagName)&&-1<a._toi_input.indexOf(e.type)&&(s=!1,c=e.value!=l,e.value=l,!(s=o.attr.input&&c)&&e["_hc:force_apply"]&&(s=!0,delete e["_hc:force_apply"]),s&&o.attr.input&&n(o.attr.input))))},i.prototype.arrayEventListener=function(n){var o=this;n.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.push).call.apply(r,[n].concat(e));return o._traces.model.listen(),r},n.pop=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.pop).call.apply(r,[n].concat(e));return o._traces.model.listen(),r},n.splice=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.splice).call.apply(r,[n].concat(e));return o._traces.model.listen(),r},n.shift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.shift).call.apply(r,[n].concat(e));return o._traces.model.listen(),r},n.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.unshift).call.apply(r,[n].concat(e));return o._traces.model.listen(),r}},i.prototype.registEventListener=function(e,t,r,n){var o=this;e.addEventListener(t,n=(n=void 0===n?null:n)||function(e){!function(e,t){var r=t;t.indexOf("(")<0&&(r+="(_event)");r=r.replace(/;$/,"");new Function(o._txts_mstr+"try{ var _event=arguments[0]; } catch(e) { _event=arguments[0]; }\nreturn "+r+";").apply(o,[e])}(e,r.value)}),this._event_listeners.push({el:e,name:t,listener:n})},i.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},i.prototype.searchTextNodes=function(e,t){if(void 0===t&&(t=null),(e=e||this.el).hasChildNodes()){for(var r=0;r<e.childNodes.length;r++)switch(e.childNodes[r].nodeType){case 1:this.searchTextNodes(e.childNodes[r],t);break;case 3:/{{([^}}\r\n]+)?}}/g.test(e.childNodes[r].textContent)&&!t&&this._traces.txts.push({node:e.childNodes[r],text:e.childNodes[r].textContent,fn:null}),t&&t._hc&&t._hc.for_txts&&t._hc.for_txts.push({node:e.childNodes[r],text:e.childNodes[r].textContent,fn:null})}this.applyTextChange()}},i.prototype.procTextNode=function(e,t){if(void 0===t&&(t=null),(e=e||this.el).hasChildNodes())for(var r=0;r<e.childNodes.length;r++)switch(e.childNodes[r].nodeType){case 1:this.procTextNode(e.childNodes[r],t);break;case 3:!t&&/{{([^}}\r\n]+)?}}/g.test(e.childNodes[r].textContent)&&this._traces.txts.push({node:e.childNodes[r],text:e.childNodes[r].textContent,fn:null}),t&&/{{([^}}\r\n]+)?}}/g.test(e.childNodes[r].textContent)&&t._hc&&t._hc.for_txts&&t._hc.for_txts.push({node:e.childNodes[r],text:e.childNodes[r].textContent,fn:null})}},i.prototype.applyTextChange=function(e){for(var t=(e=void 0===e?null:e)||this._traces.txts,r=0;r<t.length;r++)t[r].fn||(t[r].fn=this.compileText(t[r].text)),t[r].node.textContent=t[r].fn.apply(this)},i.prototype.procTextModel=function(e){for(var t=(e=void 0===e?null:e)?e._hc&&e._hc.for_txts?e._hc.for_txts:e:this._traces.txts,r=0;r<t.length;r++)t[r].fn||(t[r].fn=this.compileText(t[r].text,e&&e._hc&&e._hc.model_str?e._hc.model_str:null)),t[r].node.textContent=t[r].fn.apply(this)},i.prototype.compileText=function(e,t){if(void 0===t&&(t=null),!this._txts_mstr){this._txts_mstr="";for(var r=Object.keys(this),n=0;n<r.length;n++)1<r[n].length&&"_"===r[n].charAt(0)||(this._txts_mstr+="var "+r[n]+"=this."+r[n]+";\n")}for(var o,l=/{{([^}}]+)?}}/g,i=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,s=this._txts_mstr+(t||"")+"var r=[];\n",c=0,a=function(e,t){return s+=(t=void 0===t?null:t)?e.match(i)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",a};o=l.exec(e);)a(e.slice(c,o.index))(o[1],!0),c=o.index+o[0].length;return a(e.substr(c,e.length-c)),s+='return r.join("");',new Function(s.replace(/[\r\t\n]/g,""))},i.prototype.scrollHeight=function(e){return 9===e.nodeType?Number(window.document.documentElement.scrollHeight):Number(e.scrollHeight)},i.prototype.scrollTop=function(e){e=9===e.nodeType?window.pageYOffset:e.scrollTop;return Math.ceil(e)},i.prototype.innerHeight=function(e){e=9===e.nodeType?Number(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.documentElement.clientHeight)):Number(e.clientHeight);return Math.ceil(e)},i.prototype.refresh=function(){this.clearData(),this.init()},i.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),r=0;r<t.length;r++)e.test(t[r])&&delete this[t[r]]},i.prototype.getRandomString=function(e){for(var t="",r=0;r<e;r++){var n=Math.floor(51*Math.random());t+=String.fromCharCode(n+(n<26?65:71))}return t},i.prototype.createInstanceId=function(){return this.getRandomString(8)+"_"+Date.now()},i.prototype.createTagId=function(){return this.getRandomString(6)+"_"+Date.now()},i.prototype.isArrowFunc=function(e){return void 0===e.prototype},i.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},i.prototype.getCheckedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var o=e[n];if(o.checked&&!t){r=o.value;break}o.checked&&t&&r.push(o.value)}return r},i.prototype.getSelectedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var o=e[n];if(o.selected&&!t){r=o.value;break}o.selected&&t&&r.push(o.value)}return r},i.prototype.setCheckedValue=function(e,t){for(var r=!1,n=!1,o=0;o<e.length;o++){var l=e[o];if(!n&&l.checked&&(n=!0),r=!r&&(l.checked&&(Array.isArray(t)?t.indexOf(l.value)<0:t!=l.value)||!l.checked&&(Array.isArray(t)?-1<t.indexOf(l.value):t==l.value))?!0:r)break}for(o=0;o<e.length;o++)(l=e[o]).checked=Array.isArray(t)?-1<t.indexOf(l.value):t==l.value;return r},i.prototype.setSelectedValue=function(e,t){for(var r=!1,n=!1,o=0;o<e.length;o++){var l=e[o];if(!n&&l.selected&&(n=!0),r=!r&&(l.selected&&(Array.isArray(t)?t.indexOf(l.value)<0:t!=l.value)||!l.selected&&(Array.isArray(t)?-1<t.indexOf(l.value):t==l.value))?!0:r)break}for(o=0;o<e.length;o++)(l=e[o]).selected=Array.isArray(t)?-1<t.indexOf(l.value):t==l.value;return r},i.prototype.on=function(e,t){this._bus[e]||(this._bus[e]=[]),-1<this._bus[e].indexOf(t)||this._bus[e].push(t)},i.prototype.off=function(e,t){void 0===t&&(t=null),this._bus[e]&&!t?delete this._bus[e]:this._bus[e]&&t&&(-1<(t=this._bus[e].indexOf(t))&&this._bus[e].splice(t,1))},i.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!this._bus[e])return 0;for(var o=0,l=0;l<this._bus[e].length;l++)try{(t=this._bus[e])[l].apply(t,r),o++}catch(e){}return o},i.prototype.destroy=function(){this.clearEventListeners(),delete this._refs,this._refs={},delete this._txts_mstr,this._txts_mstr="",delete this._traces.fors,this._traces.fors=[],delete this._traces.txts,this._traces.txts=[],delete this._traces.elements,this._traces.elements=[],this._template&&this.el.parentElement.removeChild(this.el),this._template=null,delete this._el,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),delete this._on,this._on={created:null,mounted:null,destroyed:null},i.instances[this._id]&&(i.instances[this._id]=null,delete i.instances[this._id])},i.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(i.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),i._instances={},i}();window.Hacci=Hacci;
